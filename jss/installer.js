!function(){function e(){return new Promise(function(e,t){"interactive"==document.readyState||"complete"==document.readyState?e():document.addEventListener("DOMContentLoaded",e,!1)})}function t(e,t,n,r,o){return new Promise(function(a,c){var i=new XMLHttpRequest;i.open(e,t,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o&&o.forEach(function(e){i.setRequestHeader(e.hdr,e.value)}),r&&(i.responseType=r),i.addEventListener("readystatechange",function(){4==i.readyState&&a(i)},!1),i.send(n)})}function n(){return"refuri="+window.location.hostname}function r(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}function o(e,t,n,o,a,c){var i=!1;if(r(f,function(e,n){n==t&&(a&&e.push(a),i=!0)}),i)return!0;var u,s=document.createElement("a");switch(e){case"script":u=function(e){return s.href=e.src,s.pathname==t?!0:!1};break;case"link":u=function(e){return s.href=e.href,s.pathname==t?!0:!1}}for(var l=document.getElementsByTagName(e),d=0;d<l.length;d++)if(u(l[d]))return a&&a(),!0;f[t]=[],a&&f[t].push(a);var h=document.createElement(e);switch(o&&(h.charset=o),n||(n="head"),h.addEventListener("load",function(){f[t].forEach(function(e){e()}),delete f[t]},!1),e){case"script":h.type="text/javascript",c!==!1&&(h.async=!0),h.src=t;break;case"link":h.type="text/css",h.rel="stylesheet",h.href=t}document.getElementsByTagName(n)[0].appendChild(h)}function a(e){return"html"==e.type?(document.body.innerHTML=e.html,Promise.resolve()):"img"!=e.type?new Promise(function(t,n){o(e.type,e.objUrl,void 0,void 0,function(){t()},e.async)}):void 0}function c(e){return new Promise(function(t,n){return"html"==e.type?(t(e),!0):(d.getBlobUrl(e.url,e.type).then(function(n){e.objUrl=n,t(e)}),void 0)})}function i(e){var t=[];e.forEach(function(e){var n=[];e.forEach(function(e){var t=c(e);n.push(t)});var r=Promise.all(n);t.push(r)}),t.reduce(function(e,t){return e.then(function(){return t}).then(function(e){var t=[];return e.forEach(function(e){var n=a(e);t.push(n)}),Promise.all(t)})},Promise.resolve())}function u(){return t("POST",debug.checkUrl(l),n(),"json").then(function(e){var t=d.createRecordObj(e);return t&&(t.manifest=e.response,t.url=l,d.set(t)),t.manifest})}const s=604800,l="manifest.php";var d={};d.objStoreName="appFiles",d.checkDb=new Promise(function(e,t){var n=indexedDB.open("installer",2);n.addEventListener("error",function(e){t()}),n.addEventListener("upgradeneeded",function(e){var t=n.result;t.objectStoreNames.contains(d.objStoreName)||t.createObjectStore(d.objStoreName,{keyPath:"url"})}),n.addEventListener("success",function(t){d.db=n.result,e()})}),d.cache={},d.set=function(e){return this.checkDb.then(function(){return new Promise(function(t,n){var r=d.db.transaction(d.objStoreName,"readwrite").objectStore(d.objStoreName).put(e);r.addEventListener("success",function(){d.cache[e.url]=e,t()})})})},d.rmv=function(e){return this.checkDb.then(function(){return new Promise(function(t,n){var r=d.db.transaction(d.objStoreName,"readwrite").objectStore(d.objStoreName)["delete"](e);r.addEventListener("success",function(){delete d.cache[e],t()}),r.addEventListener("error",n)})})},d.get=function(e){return this.cache[e]?Promise.resolve(this.cache[e]):this.checkDb.then(function(){return new Promise(function(t,n){var r=d.db.transaction(d.objStoreName).objectStore(d.objStoreName).get(e);r.addEventListener("success",function(){r.result?(d.cache[e]=r.result,t(d.cache[e])):n()}),r.addEventListener("error",n)})})},d.ouCache={},d.checkCss_checkObjUrl=function(e,t,n){var r=/(.*\/)[^\/]*$/;t=r.exec(t)[1];var o=/\.\.\//g,a=(e.match(o)||[]).length;if(a>0)for(var c=/[^\/]+\/$/,i=0;a>i;i++)t=t.replace(c,"");var u=e.replace(o,""),s=t+u,l;return".css"==s.substr(s.length-4)&&(l="link"),new Promise(function(t,r){d.getObjUrl(s,l).then(function(t){n.push({subStr:e,repStr:t.objUrl})},function(){n.push({subStr:e,repStr:window.location.origin+s})}).then(function(){t()})})},d.checkCss=function(e,t){return new Promise(function(n,r){var o=new FileReader;o.addEventListener("loadend",function(){for(var r=o.result,a=[],c=/url\(([^\)]+)\)/g,i;null!==(i=c.exec(r));)a.push(i[1]);new Promise(function(e,n){if(a.length>0){var o=[],c=[];a.forEach(function(e){var n=d.checkCss_checkObjUrl(e,t,o);c.push(n)}),Promise.all(c).then(function(){o.forEach(function(e){r=r.replace("url("+e.subStr+")","url("+e.repStr+")")}),e()})}else e()}).then(function(){n(new Blob([r],{type:e.type}))})}),o.readAsText(e)})},d.ouCache_setAndReturn=function(e,t){return this.ouCache[e]={objUrl:URL.createObjectURL(t.blob),record:t},this.ouCache[e]},d.getObjUrl=function(e,t){if("link"==t){var n=e+"_tmpCopy";return this.ouCache[n]?Promise.resolve(this.ouCache[n]):d.get(e).then(function(t){return d.checkCss(t.blob,e)}).then(function(e){var t={blob:e,url:n};return d.set(t)}).then(function(){return d.get(n)}).then(function(e){return d.ouCache_setAndReturn(n,e)})}return this.ouCache[e]?Promise.resolve(this.ouCache[e]):d.get(e).then(function(t){return d.ouCache_setAndReturn(e,t)})},d.createRecordObj=function(e){if(200!==e.status)return!1;var t={dlDate:Date.now(),lastModified:e.getResponseHeader("Last-Modified")},n=/max\-age=([0-9]+)($|,)/;t.maxAge=n.exec(e.getResponseHeader("Cache-Control")),t.maxAge=null==t.maxAge?0:parseInt(t.maxAge[1]);var r=e.getResponseHeader("Etag");return r&&(t.eTag=r),t},d.checkExpire=function(e){return e.dlDate+1e3*e.maxAge<Date.now()?!0:!1},d.createHdrFrom=function(e){var t=[{hdr:"If-Modified-Since",value:e.lastModified}];return e.eTag&&t.push({hdr:"If-None-Match",value:e.eTag}),t},d.checkUpdate=function(e,n,r){return t("GET",n,void 0,r,this.createHdrFrom(e)).then(function(e){if(200==e.status)return e;throw e})},d.setBlob=function(e,t){var n=d.createRecordObj(t);return n?(n.blob=t.response,n.url=e,d.set(n)):void 0},d.dlAndSetBlob=function(e){return t("POST",e,n(),"blob").then(function(t){return d.setBlob(e,t)})},d.getBlobUrl=function(e,t){return d.getObjUrl(e,t).then(function(t){var n=t.record;return d.checkExpire(n)&&d.checkUpdate(n,e,"blob").then(function(){d.dlAndSetBlob(e)}),t.objUrl},function(){return d.dlAndSetBlob(e).then(function(){return d.getObjUrl(e,t)}).then(function(e){return e.objUrl})})},debug={},debug.checkUrl=function(e){return"/debug/view.php"==window.location.pathname?"/"+e:e};var f={},h=["jss/installer.js","shared/imgs/favicon.ico","shared/csss/default.css"],m=localStorage.getItem("installDate");m||(m=(new Date).toUTCString(),localStorage.setItem("installDate",m),localStorage.setItem("installerLastCheckDate","0")),parseInt(localStorage.getItem("installerLastCheckDate"))+0<Date.now()&&(h.forEach(function(e){e=debug.checkUrl(e);var n=localStorage.getItem(e+"_lastModified");n&&"null"!=n||(n=m);var r=[{hdr:"If-Modified-Since",value:n}],o=localStorage.getItem(e+"_eTag");o&&r.push({hdr:"If-None-Match",value:o}),t("GET",e,void 0,void 0,r).then(function(t){if(200==t.status){localStorage.setItem(e+"_lastModified",t.getResponseHeader("Last-Modified"));var n=t.getResponseHeader("Etag");n?localStorage.setItem(e+"_eTag",n):localStorage.removeItem(e+"_eTag")}})}),localStorage.setItem("installerLastCheckDate",Date.now())),d.get(l).then(function(e){if(d.checkExpire(e)){var n=[{hdr:"If-Modified-Since",value:e.lastModified}];return e.eTag&&n.push({hdr:"If-None-Match",value:e.eTag}),t("GET",debug.checkUrl(l),void 0,"json",n).then(function(e){return 200==e.status?u():void 0},function(){return e.manifest})}return e.manifest},function(){return u()}).then(function(e){i(e)})}();