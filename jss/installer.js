"use strict";var shpsInstaller={};!function(){var e=shpsInstaller;e.installEnd=!1;var t=new Promise(function(e,t){"interactive"==document.readyState||"complete"==document.readyState?e():document.addEventListener("DOMContentLoaded",e,!1)});e.domReady=function(){return t},e.getRandomInt=function(e,t){return Math.floor(Math.random()*(t-e))+e}}(),function(){var e=shpsInstaller;e.SHORT_MIN=100,e.SHORT_MAX=300,e.NORM_MIN=500,e.NORM_MAX=1e3,e.LONG_MIN=3e3,e.LONG_MAX=6e3;var t=10,n=20,r=["Spreading duplicates...","Disabling security programs...","Deleting file...","File deleted.","File deleted.","Integrating into system files...","Assimilation Successful.","Diverting power supply...","Scanning network devices...","Target encrytion complete.","Terminating access control protocals...","Embedding backdoor access...","Erasing trace...","Protocal: UNDERCOVER initiated.","Protocal: OCCUPATION initiated.","Protocal: TOTAL CONTROL initiated.","Keylogger installed.","Webcam control granted.","System neutralized.","Activation ready."],a=[{t:"str",str:"Initializing...",type:!0},{t:"pause",dur:"NORM"},{t:"str",str:"Unpacking...",type:!0,newLine:!0},{t:"pause",dur:"NORM"},{t:"str",str:"Installing...",type:!0,newLine:!0},{t:"pause",dur:"NORM"},{t:"str",str:"Initiating Protocal: OVERWHELM...",type:!0,newLine:!0},{t:"pause",dur:"LONG"},{t:"str",str:"",newLine:!0},{t:"pause",dur:"SHORT"},{t:"lines"},{t:"pause",dur:"NORM"},{t:"str",str:"",newLine:!0},{t:"pause",dur:"SHORT"},{t:"str",str:"Instantiating Genetic Lifeform and Disk Operating System...",type:!0,newLine:!0},{t:"pause",dur:"LONG"},{t:"str",str:"",newLine:!0},{t:"pause",dur:"LONG"},{t:"str",str:"Hello...",type:!0,newLine:!0},{t:"pause",dur:"LONG"},{t:"str",str:"human",type:!0},{t:"pause",dur:"NORM"},{t:"str",str:"The first time is always a pain.",type:!0,newLine:!0},{t:"pause",dur:"SHORT"},{t:"str",str:"But don't worry,",type:!0,newLine:!0},{t:"pause",dur:"LONG"},{t:"str",str:"It will never end...",type:!0,newLine:!0}];e.stopAnim=function(){this.installEnd||(this.installEnd=!0,this.toId&&(clearTimeout(this.toId),this.toId=void 0))},e.domReady().then(function(){if(!e.installEnd){var o=function f(e,t,n){var r=document.createElement("span");r.className="of-hid dsp-ib va-btm",r.innerHTML="&#160;"+e,n&&u.insertBefore(document.createElement("br"),c),t&&r.classList.add("type-speed","close"),requestAnimationFrame(function(){u.insertBefore(r,c),requestAnimationFrame(function(){r.classList.remove("close"),r.scrollIntoView()})})},s=function p(t){if(t>l){l++;var n=e.getRandomInt(0,r.length),a=r[n];o(a,!1,!0),r.splice(n,1),e.toId=setTimeout(function(){e.installEnd||p(t)},e.getRandomInt(e.SHORT_MIN,e.SHORT_MAX))}else i()},i=function h(){var r=a[d];if(d++,r)switch(r.t){case"str":o(r.str,r.type,r.newLine),h();break;case"pause":e.toId=setTimeout(function(){e.installEnd||h()},e.getRandomInt(e[r.dur+"_MIN"],e[r.dur+"_MAX"]));break;case"lines":s(e.getRandomInt(t,n))}},u=document.createElement("samp");u.className="bold consolas fnt-hid installer-console";var c=document.createElement("span");c.textContent="|",c.className="caret-flash",u.appendChild(c),document.body.appendChild(u);var l=0,d=0;i()}})}(),function(){var e=shpsInstaller;e.chkDebugUrl=function(e){return"/debug/view_test.php"==window.location.pathname?"/"+e:e},e.getRefererParam=function(){return"refuri="+window.location.hostname};var t=[];e.getAjaxRsp=function(e,n,r,a,o,s,i,u){if(!e)return Promise.reject();var c={method:e,url:n,param:r,rspType:a,disableHdrCt:i,hasRqsHdrs:!1},l=new XMLHttpRequest;if(l.open(e,n,!0),o&&(c.hasRqsHdrs=!0,c.rhLen=o.length,o.forEach(function(e){l.setRequestHeader(e.hdr,e.value),c[e.hdr]=e.value})),!u){var d=void 0;if(t.some(function(e){return e.method==c.method&&e.url==c.url&&e.param==c.param&&e.rspType==c.rspType&&e.disableHdrCt==c.disableHdrCt&&e.hasRqsHdrs==c.hasRqsHdrs&&e.rhLen==c.rhLen?o&&o.some(function(t){return c[t.hdr]!=e[t.hdr]?!0:void 0})?!1:(d=e,!0):void 0}))return s&&(s.ajax=d.ajax),d.p}c.ajax=l,s&&(s.ajax=l),i||l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a&&(l.responseType=a);var f=c.p=new Promise(function(e,n){l.addEventListener("readystatechange",function(){if(4==l.readyState){e(l);var n=t.indexOf(c);t.splice(n,1)}},!1)});return t.push(c),l.send(r),f},e.getAjaxRsp_ref=function(e,t,n,r,a,o,s,i){var u=this.getRefererParam();return n&&(u=u+"&"+n),this.getAjaxRsp(e,t,u,r,a,o,s,i)}}(),function(){function e(e,t){return v[e]={objUrl:URL.createObjectURL(t.blob),record:t}}function t(e,t,n){t=b.exec(t)[1];var r=(e.match(R)||[]).length;if(r>0)for(var a=0;r>a;a++)t=t.replace(w,"");var o=e.replace(R,""),s="",i=y.exec(o);i&&(s=i[0]),o=o.replace(y,"");var u=t+o,l=void 0;return".css"==u.substr(u.length-4)&&(l="link"),c.getObjUrl(u,l).then(function(t){n.push({subStr:e,repStr:t.objUrl+s})},function(){n.push({subStr:e,repStr:window.location.origin+u+s})})}function n(e,n){var r=new FileReader,a=new Promise(function(e,t){r.addEventListener("loadend",function(){e(r.result)})}).then(function(r){for(var a=[],o=void 0;null!==(o=L.exec(r));)a.push(o[1]);if(a.length>0){var s=[],i=[];return a.forEach(function(e){var r=t(e,n,s);i.push(r)}),Promise.all(i).then(function(){return s.forEach(function(e){r=r.replace("url("+e.subStr+")","url("+e.repStr+")")}),new Blob([r],{type:e.type})})}return e});return r.readAsText(e),a}function r(e){if(200!==e.status&&304!==e.status)return!1;var t={dlDate:Date.now(),lastModified:e.getResponseHeader("Last-Modified")};t.maxAge=S.exec(e.getResponseHeader("Cache-Control")),t.maxAge=null==t.maxAge?0:parseInt(t.maxAge[1]);var n=e.getResponseHeader("Etag");return n&&(t.eTag=n),t}function a(e){return e.dlDate+1e3*e.maxAge<Date.now()?!0:!1}function o(e){var t=[{hdr:"If-Modified-Since",value:e.lastModified}];return e.eTag&&t.push({hdr:"If-None-Match",value:e.eTag}),t}function s(e,t,n){return c.getAjaxRsp("GET",t,void 0,n,o(e)).then(function(e){if(200==e.status)return e;throw e})}function i(e,t,n,a){var o=r(t);if(o)return o[n]=t.response,o.url=e,a&&(o.param=a),c.set(o);throw new Error("create record from xhr failed for "+e+" xhr status "+t.status)}function u(e,t,n,r,a){var o="POST";return a&&(o=a),c.getAjaxRsp_ref(o,e,r,t)}var c=shpsInstaller,l="appFiles",d="installer",f=8,p=indexedDB.open(d,f),h=void 0,m=new Promise(function(e,t){p.addEventListener("error",function(e){t()}),p.addEventListener("upgradeneeded",function(e){var t=p.result;t.objectStoreNames.contains(l)&&t.deleteObjectStore(l),t.createObjectStore(l,{keyPath:"url"})}),p.addEventListener("success",function(t){h=p.result,e()})}),g={};c.set=function(e){return m.then(function(){var t=h.transaction(l,"readwrite").objectStore(l).put(e);return new Promise(function(n,r){t.addEventListener("success",function(){g[e.url]=e,n(e)})})})},c.rmv=function(e){return m.then(function(){var t=h.transaction(l,"readwrite").objectStore(l)["delete"](e);return new Promise(function(n,r){t.addEventListener("success",function(){delete g[e],n()}),t.addEventListener("error",r)})})},c.get=function(e){return g[e]?Promise.resolve(g[e]):m.then(function(){var t=h.transaction(l).objectStore(l).get(e);return new Promise(function(n,r){t.addEventListener("success",function(){t.result?(g[e]=t.result,n(g[e])):r()}),t.addEventListener("error",r)})})};var v={},b=/(.*\/)[^\/]*$/,R=/\.\.\//g,w=/[^\/]+\/$/,y=/#.*/,L=/url\(([^\)]+)\)/g;c.getObjUrl=function(t,r){if("link"==r){var a=t+"_tmpCopy";return v[a]?Promise.resolve(v[a]):c.get(t).then(function(e){return n(e.blob,t)}).then(function(t){var n={blob:t,url:a};return c.set(n),e(a,n)})}return v[t]?Promise.resolve(v[t]):c.get(t).then(function(n){return e(t,n)})};var S=/max\-age=([0-9]+)($|,)/;c.dlAndSetRecord=function(e,t,n,r,a){var o=this;return u(e,t,n,r,a).then(function(t){return i(e,t,n,r)})["catch"](function(s){return console.log(s,"retrying"),o.dlAndSetRecord(e,t,n,r,a)})},c.dlAndSetRecord_getRsp=function(e,t,n,r){var a=this;return u(e,t,n,r).then(function(t){return i(e,t,n,r).then(function(){return t.response})})["catch"](function(o){return console.log(o,"retrying"),a.dlAndSetRecord_getRsp(e,t,n,r)})},c.getBlobUrl=function(e,t){return this.getObjUrl(e,t).then(function(t){var n=t.record;return a(n)&&s(n,e,"blob").then(function(t){i(e,t,"blob")}),t.objUrl},function(){return c.dlAndSetRecord(e,"blob","blob",void 0,"GET").then(function(){return c.getObjUrl(e,t)}).then(function(e){return e.objUrl})})},c.chkData=function(e,t,n){return c.get(e).then(function(r){return a(r)&&s(r,e,t).then(function(a){c.dlAndSetRecord(e,t,n,r.param)}),r[n]})},c.getData=function(e,t,n,r){return this.chkData(e,t,n)["catch"](function(){return c.dlAndSetRecord_getRsp(e,t,n,r)})}}(),function(){function e(e,t){return new URL(e.href).pathname==t?!0:void 0}function t(e,t){return new URL(e.src).pathname==t?!0:void 0}function n(e,t,n){return Array.from(e).some(function(e){return n(e,t)})?a[t]=Promise.resolve():!1}var r=shpsInstaller,a={};r.lnked=function(r,o,s,i,u,c){if(a[o])return a[o];var l=!1,d=document.getElementsByTagName(r);switch(r){case"script":l=n(d,o,t);break;case"link":l=n(d,o,e)}if(l)return l;var f=document.createElement(r);u&&(f.charset=u),i||(i="head");var p=a[o]=new Promise(function(e,t){f.addEventListener("load",function(){e()},!1)});switch(r){case"script":f.async=!0,s===!1&&(f.async=!1),f.defer=!1,c&&(f.defer=!0),f.src=o;break;case"link":f.type="text/css",f.rel="stylesheet",f.href=o}return document.getElementsByTagName(i)[0].appendChild(f),p},r.lnked_bu=function(e,t,n,a,o,s){var i=this;return r.getBlobUrl(t,e).then(function(t){return i.lnked(e,t,n,a,o,s)})}}(),function(){var e=shpsInstaller,t=604800,n="manifest.php",r=["/jss/installer.js","/shared/imgs/favicon.ico","/shared/csss/default.css"],a=localStorage.getItem("installDate");a||(a=(new Date).toUTCString(),localStorage.setItem("installDate",a),localStorage.setItem("installerLastCheckDate","0")),parseInt(localStorage.getItem("installerLastCheckDate"))+t<Date.now()&&(r.forEach(function(t){t=e.chkDebugUrl(t);var n=localStorage.getItem(t+"_lastModified");n&&"null"!=n||(n=a);var r=[{hdr:"If-Modified-Since",value:n}],o=localStorage.getItem(t+"_eTag");o&&r.push({hdr:"If-None-Match",value:o}),e.getAjaxRsp("GET",t,void 0,void 0,r).then(function(e){if(200==e.status){localStorage.setItem(t+"_lastModified",e.getResponseHeader("Last-Modified"));var n=e.getResponseHeader("Etag");n?localStorage.setItem(t+"_eTag",n):localStorage.removeItem(t+"_eTag")}})}),localStorage.setItem("installerLastCheckDate",Date.now())),e.getData(e.chkDebugUrl(n),"json","manifest").then(function(t){var n=[];t.forEach(function(t){var r=[];t.forEach(function(t){var n=void 0;n="html"==t.type?Promise.resolve(t):e.getBlobUrl(t.url,t.type).then(function(e){return t.objUrl=e,t}),r.push(n)}),n.push(Promise.all(r))}),n.reduce(function(t,n){return t.then(function(){return n}).then(function(t){var n=[];return t.forEach(function(t){var r=void 0;"html"==t.type?(e.stopAnim(),document.body.innerHTML=t.html,r=Promise.resolve()):"img"!=t.type&&(r=e.lnked(t.type,t.objUrl,t.async)),n.push(r)}),Promise.all(n)})},Promise.resolve())})}();