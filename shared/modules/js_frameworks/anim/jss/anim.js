"use strict";function _classCallCheck(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,s){for(var e=0;e<s.length;e++){var n=s[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(s,e,n){return e&&t(s.prototype,e),n&&t(s,n),s}}();!function(){var t="anim_fw",s=shpsCmm.moduleMgr,e=shpsCmm.evtMgr;s.hooks[t]=function(t){function s(t,s){return 1-3*s+3*t}function n(t,s){return 3*s-6*t}function r(t){return 3*t}function i(t,e,i){return((s(e,i)*t+n(e,i))*t+r(e))*t}function a(t,e,i){return 3*s(e,i)*t*t+2*n(e,i)*t+r(e)}function o(t,s,e,n,r){var a=void 0,o=void 0,u=0;do o=s+(e-s)/2,a=i(o,n,r)-t,a>0?e=o:s=o;while(Math.abs(a)>_&&++u<v);return o}function u(t,s,e,n){function r(s,n){for(var r=0;c>r;++r){var o=a(n,t,e);if(0===o)return n;var u=i(n,t,e)-s;n-=u/o}return n}function u(){for(var s=0;d>s;++s)v[s]=i(s*p,t,e)}function h(s){for(var n=0,i=1,u=d-1;i!=u&&v[i]<=s;++i)n+=p;--i;var h=(s-v[i])/(v[i+1]-v[i]),l=n+h*p,c=a(l,t,e);return c>=f?r(s,l):0===c?l:o(s,n,n+p,t,e)}function l(){y=!0,(t!=s||e!=n)&&u()}if(4!==arguments.length)throw new Error("BezierEasing requires 4 arguments.");for(var _=0;4>_;++_)if("number"!=typeof arguments[_]||isNaN(arguments[_])||!isFinite(arguments[_]))throw new Error("BezierEasing arguments should be integers.");if(0>t||t>1||0>e||e>1)throw new Error("BezierEasing x values must be in [0, 1] range.");var v=g?new Float32Array(d):new Array(d),y=!1,m=function C(r){return y||l(),t===s&&e===n?r:0===r?0:1===r?1:i(h(r),s,n)};m.getControlPoints=function(){return[{x:t,y:s},{x:e,y:n}]};var E=[t,s,e,n],T="BezierEasing("+E+")";m.toString=function(){return T};var k="cubic-bezier("+E+")";return m.toCSS=function(){return k},m}function h(t,s){return-1!=s.indexOf(t)?!0:!1}var l=t.obj={},c=4,f=.001,_=1e-7,v=10,d=11,p=1/(d-1),g="Float32Array"in window;u.css={ease:u(.25,.1,.25,1),linear:u(0,0,1,1),"ease-in":u(.42,0,1,1),"ease-out":u(0,0,.58,1),"ease-in-out":u(.42,0,.58,1)};var y=24,m=1e3/y,E=u(0,.4,1,.5),T=function(){function t(s,e,n,r,i,a,o){_classCallCheck(this,t),this.play=this.play.bind(this),this.setFrame(s),this.start=e,this.to=n,this.setDur(r),this._itv=m,a?this._itv=1e3/a:a===!1&&(this._itv=0),this.delay=o||0,this._setTtlChange(),this._timePassed=0,this._progress=0,this.setEasing(i),this._lastTs=void 0,this._intendTs=0,this._state="stop",this._transEndLsnrs=[]}return _createClass(t,[{key:"_setTtlChange",value:function s(){this._ttlChange=this.to-this.start}},{key:"_quadEaseOut",value:function e(){var t=this._progress;return-this._ttlChange*t*(t-2)+this.start}},{key:"_easeMiddle",value:function n(){return this._ttlChange*E(this._progress)+this.start}},{key:"_quadEaseIn",value:function r(){var t=this._progress;return this._ttlChange*t*t+this.start}},{key:"_quadEaseInOut",value:function i(){var t=2*this._progress;return 1>t?this._ttlChange/2*t*t+this.start:(t--,-this._ttlChange/2*(t*(t-2)-1)+this.start)}},{key:"_qrtEaseIn",value:function a(){var t=this._progress;return this._ttlChange*t*t*t*t+this.start}},{key:"_step",value:function o(t){t>=this._intendTs&&(this._timePassed+=t-this._lastTs,this._lastTs=t,this._progress=this._timePassed/this.dur,this._progress>1&&(this._progress=1),this.frame(this._delta()),this._intendTs+=this._itv),this._progress>=1?this.stop():"play"==this._state&&this.play()}}]),_createClass(t,[{key:"setFrame",value:function u(t){this.frame=t}},{key:"setStart",value:function l(t){this.start=t,this._setTtlChange()}},{key:"setTo",value:function c(t){this.to=t,this._setTtlChange()}},{key:"setDur",value:function f(t){this.dur=t}},{key:"setEasing",value:function _(t){this._delta=this["_"+t]}},{key:"addEvtLsnr",value:function v(t,s){switch(t){case"end":h(s,this._transEndLsnrs)||this._transEndLsnrs.push(s);break;default:return!1}}},{key:"rmvEvtLsnr",value:function d(t,s){switch(t){case"end":var e=this._transEndLsnrs.indexOf(s);-1!=e&&this._transEndLsnrs.splice(e,1);break;default:return!1}}},{key:"play",value:function p(){var t=this;return this._ttlChange?this._progress>=1?(this.replay(),void 0):(this._state="play",this._lastTs||(this._lastTs=this._intendTs=performance.now()),this._afId=window.requestAnimationFrame(function(s){t._step(s)}),void 0):!0}},{key:"replay",value:function g(){this._timePassed=0,this._progress=0,this._lastTs=void 0,this.play()}},{key:"pause",value:function y(){this._state="pause"}},{key:"stop",value:function T(){this._state="stop",this._transEndLsnrs.forEach(function(t){t()})}}]),t}();l.Trans=T,l.transScrl=function(t,s,n,r,i){function a(){o.stop()}t.tsTrans?t.tsTrans.stop():t.tsTrans=new T(void 0,void 0,s,r,"quadEaseInOut");var o=t.tsTrans;o.setTo(s),i||(i=function l(){});var u=void 0;if(n&&t.scrollLeft!==s)u=r?1e3*r:Math.abs(s-t.scrollLeft),o.setFrame(function(s){t.scriptScrl=!0,t.scrollLeft=s,i()}),o.setStart(t.scrollLeft),o.setDur(u);else{if(n||t.scrollTop===s)return!0;u=r?1e3*r:Math.abs(s-t.scrollTop),o.setFrame(function(s){t.scriptScrl=!0,t.scrollTop=s,i()}),o.setStart(t.scrollTop),o.setDur(u)}var h=new Promise(function(s,n){o.addEvtLsnr("end",function(){e.rmvEvtLsnr(t,"optScrl",a),s()})});return e.addEvtLsnr(t,"optScrl",a),o.play(),h}}}();