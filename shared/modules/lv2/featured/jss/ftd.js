"use strict";!function(){var t="lv2_featured",e="/shared/modules/contour/",i="ftd-ctt-cnr",n="ftd-ctt-col",r="ftd-ctt-block",s="ftd-ctt-img-cnr",o="ftd-ctt-img",a=shpsCmm.moduleMgr;a.hooks[t]=function(t){var d=t.obj={},m=d.lv2Ftd=function(t,e,n){var r=this;this.cnr=t,this.cttCnr=t.getElementsByClassName(i)[0],this.itemIdx=0,this.ldedP=shpsCmm.createAjax("POST",e,shpsCmm.getRefererParam()+"&refpg="+window.location.hash,"json").then(function(t){var e=t.response;if("Array"==classOf(e))return e.forEach(function(t){imgPreload(t.img_url)}),m.getContour(),r.ftdCtt=e,void 0;throw new Error("ftd ctt ld failed")})};m.prototype.lded=function(){return this.ldedP},m.prototype.intro=function(t){var e=this.cnr;return new Promise(function(i,n){requestAnimationFrame(function(){e.classList.remove("dsp-non"),e.addEventListener("transitionend",function n(t){return t.target!=this?!1:(this.removeEventListener("transitionend",n),i(),void 0)}),requestAnimationFrame(function(){e.style.height=t})})})},m.prototype.createCtt=function(){function t(t){var e=d,i=h,n=a.offsetWidth,r=a.offsetHeight;e=n,i=e/A,r>i&&(i=r,e=i*A);var s=t.parentNode.parentNode,o=t.offsetWidth,m=t.offsetHeight,c=0,l=0;o!=e&&(c=(n/2-s.parentNode.offsetLeft-e/2)/(o-e)*100),m!=i&&(l=(r/2-s.offsetTop-i/2)/(m-i)*100);var g=e/o*100,f=i/m*100;t.style.backgroundSize=g+"% "+f+"%",t.style.backgroundPosition=c+"% "+l+"%"}var e=this.ftdCtt[this.itemIdx],i=e.img_url;this.imgLdedP=shpsCmm.imgLdr.imgLded(i);var a=this.cttCnr,d=e.img_wdt,h=e.img_hgt,c=e.item_link,l=e.txt,g=e.txt_pstn,f=e.txt_wdt,u=e.txt_html,v=a.children[0];this.ttlWdt=a.offsetWidth,this.ttlHgt=a.offsetHeight,this.block_hgt_min=Math.round(this.ttlHgt/3),this.img_wdt_min=Math.round(this.ttlWdt/6),this.img_wdt_max=this.ttlWdt-this.img_wdt_min;var p=this.ttlWdt,_=p,w;if(l){if(w="txt","undefined"==typeof g||"lft"!=g){var y=["lft","ctr","rgt"];g=y[getRandomInt(0,3)]}if("ctr"==g){var x=this.ttlWdt-2*this.img_wdt_min;("undefined"==typeof f||f>x)&&(f=getRandomInt(img_wdt_min,x+1)),this.img_wdt_max-=f}else("undefined"==typeof f||f>this.img_wdt_max)&&(f=getRandomInt(this.img_wdt_min,this.img_wdt_max+1)),this.img_wdt_max=this.ttlWdt-f;_=this.ttlWdt-f}else{var C=["even","random"];w=C[getRandomInt(0,2)]}for(var L=[],b=0,k=0,E=[];p;){var H="img";switch(w){case"txt":switch(g){case"lft":0===b&&(H="txt");break;case"ctr":1==b&&(H="txt");break;case"rgt":p<f+this.img_wdt_min&&(H="txt")}break;case"even":H="img";break;case"random":H="img"}var P="";switch(H){case"img":L[b]=getRandomInt(this.img_wdt_min,this.img_wdt_max+1),_-L[b]<this.img_wdt_min&&(L[b]=_);for(var B=0,I=[],N=this.ttlHgt;N>=this.block_hgt_min;){var W;if(0===B){var O;O=L[b]>=2*this.img_wdt_min?.1*this.ttlHgt:this.ttlHgt-this.block_hgt_min,W=getRandomInt(0,O+1),N-=W}else W+=I[B-1].hgt;var R=getRandomInt(this.block_hgt_min,this.ttlHgt-W);N-=R;var T=R/this.ttlHgt*100,F=W/this.ttlHgt*100;P+='\r\n							<div class="'+r+'" style="top:'+F+"%;height:"+T+'%;">\r\n								<div class="'+s+'">\r\n									<a href="'+c+'" title="Open the featured article." class="'+o+'" style="background-image:url('+i+');">\r\n									</a>\r\n								</div>\r\n							</div>',I[B]={top:W,hgt:R},B++}_-=L[b];break;case"txt":L[b]=f,P=txtHTML}E.push('<div class="'+n+'" style="width:'+L[b]+'px"><!--col stands for column-->'+P+"\r\n				</div>"),p-=L[b],k+=L[b],b++}v.innerHTML=E.join(""),this.contourP=m.contourP.then(function(t){forEachNodeItem(v.getElementsByClassName(o),function(e){var i=t.cloneNode(!0);e.appendChild(i),requestAnimationFrame(function(){i.classList.remove("opa-0")})})});var A=d/h,M=[];return forEachNodeItem(v.getElementsByClassName(o),function(e){M.push(shpsCmm.optElmRszLsnr.add(e,function(){t(e)}))}),Promise.all(M)},m.prototype.introBlks=function(){var t=this.cttCnr;this.imgLdedP.then(function(){t.classList.remove("vsb-hid");var e=new Promise(function(e,i){t.addEventListener("transitionend",function n(t){return t.target!=this?!1:(this.removeEventListener("transitionend",n),e(),void 0)})});return requestAnimationFrame(function(){t.classList.remove("opa-0")}),e})},m.prototype.maxBlks=function(){var t=this.cttCnr;if(!t.mB){t.mB=!0;var e=this;forEachNodeItem(t.getElementsByClassName(n),function(t,i){forEachNodeItem(t.children,function(i,n){if(i.mBOrigTop||(i.mBOrigTop=parseFloat(i.style.top)),i.mBOrigHgt||(i.mBOrigHgt=parseFloat(i.style.height)),0===n){var r=i.mBOrigTop+i.mBOrigHgt;i.style.top=0,i.style.height=r+"%"}n===t.children.length-1&&(i.style.height=100-parseFloat(i.style.top)+"%");var s=i.children[0];s.style.bottom=0,s.style.right=0;var o=s.children[0];o.style.boxShadow="none",e.contourP.then(function(){o.getElementsByTagName("div")[0].classList.add("opa-0")})})})}},m.getContour=function(){return this.contourP?this.contourP:this.contourP=a.get(e).then(function(t){var e=document.createElement("div");return e.innerHTML='<div class="contour-wpr opa-0 fade-in-norm">\r\n					'+t.html+"\r\n				</div>",e.children[0]})}}}();