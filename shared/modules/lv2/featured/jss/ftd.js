"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}();!function(){var t="lv2_featured",e="/shared/modules/contour/",n="/shared/modules/charts/",s="ftd-ctt-col",r="ftd-ctt-block",i="ftd-ctt-img-cnr",l="ftd-ctt-img",a=3,o=1,c=6,d=2,u=100/a,_=["lft","ctr","rgt"],h=["even","random"],m=.2,f=.5,p=10,v=shpsCmm.moduleMgr,g=shpsAjax.lnkMgr,C=shpsCmm.dataMgr.arr,y=shpsCmm.optElmRszLsnr,k=shpsCmm.evtMgr,E=shpsCmm.swipeClick;v.hooks[t]=function(t){var a=t.obj={},C=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._setElm=n._setElm.bind(n),n}return _inherits(e,t),_createClass(e,[{key:"getElm",value:function n(){return this._elm}},{key:"_setElm",value:function s(t){this._elm=t}},{key:"render",value:function a(){return React.createElement("div",{className:r,style:this.props.style},React.createElement("div",{className:i},React.createElement("a",{href:this.props.href,title:this.props.ttl,className:l,style:this.props.imgStyle})))}}]),e}(React.Component),b=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._setElm=n._setElm.bind(n),n}return _inherits(e,t),_createClass(e,[{key:"getElm",value:function n(){return this._elm}},{key:"_setElm",value:function r(t){this._elm=t}},{key:"render",value:function i(){return React.createElement("div",{className:s,style:this.props.style},this.props.children)}}]),e}(React.Component),I=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));n._setElm=n._setElm.bind(n),n._setTr=n._setTr.bind(n);var s=n.props.item,r=s.img_url;n._imgLdedP=shpsCmm.imgLdr.imgLded(r);var i=s.img_wdt,l=s.img_hgt,a=s.item_link,m=s.txt,f=s.txt_html;n._imgAr=i/l;var p=s.txt_wdt,v=s.txt_pstn;n._avlWdt=100,n._rqdCols=d,n._numColsMax=c,n._calcColWdts();var g=void 0,y=void 0;m?(g="txt",v&&_.includes(v)||(v=_[getRandomInt(0,_.length)]),"ctr"===v&&(n._rqdCols%2===0&&(n._rqdCols++,n._numColsMax<n._rqdCols&&(n._numColsMax=n._rqdCols),n._calcColWdts()),y=(n._rqdCols-1)/2),p?p>n._colWdtMax&&(p=n._colWdtMax):p=getRandomInt(n._colWdtMin,n._colWdtMax+1)):g=h[getRandomInt(0,h.length)];var k=0;for(n._cols=[];n._avlWdt;){var E="img";switch(g){case"txt":switch(v){case"lft":0===k&&(E="txt");break;case"ctr":k===y&&(E="txt");break;case"rgt":n._avlWdt<n._colWdtMin&&(E="txt",p=n._avlWdt)}break;case"even":E="img";break;case"random":E="img";break;default:E="img"}var I=void 0,R=[];switch(0===k&&p&&(n._avlWdt-=p,n._rqdCols--),E){case"img":var S=function(){var t=function h(){c=s-u*(l-1)};n._calcColWdts(),I=getRandomInt(n._colWdtMin,n._colWdtMax+1),n._avlWdt-I<n._colWdtMin&&(I=n._avlWdt);for(var e=0,s=100,i=0,l=o,c=void 0;s>=u;){if(0===e){var d=100-u*o;I>=2*n._colWdtMin&&(d=10),i=getRandomInt(0,d+1),s-=i}t();var _=getRandomInt(u,c);R.push(React.createElement(C,{key:e,style:{top:i+"%",height:_+"%"},href:a,ttl:"Open the featured article.",imgStyle:{backgroundImage:"url("+r+")"}})),l>1&&l--,i+=_,s-=_,e++}return n._rqdCols>1&&n._rqdCols--,n._avlWdt-=I,"break"}();if("break"===S)break;case"txt":I=p}n._cols.push(React.createElement(b,{key:k,style:{width:I+"%"}},R)),k++}return n}return _inherits(e,t),_createClass(e,[{key:"_setElm",value:function n(t){this._elm=t}},{key:"_setTr",value:function s(t){this._tr=t}},{key:"_calcColWdts",value:function r(){this._colWdtMin=100/this._numColsMax,this._colWdtMax=this._avlWdt-this._colWdtMin*(this._rqdCols-1)}},{key:"_updateBg",value:function i(t){var e=this._imgWdt,n=this._imgHgt,s=this._elm,r=s.offsetWidth,i=s.offsetHeight;e=r,n=e/this._imgAr,i>n&&(n=i,e=n*this._imgAr);var l=t.parentNode.parentNode,a=t.offsetWidth,o=t.offsetHeight,c=0,d=0;a!==e&&(c=(r/2-l.parentNode.offsetLeft-e/2)/(a-e)*100),o!==n&&(d=(i/2-l.offsetTop-n/2)/(o-n)*100);var u=e/a*100,_=n/o*100;t.style.backgroundSize=u+"% "+_+"%",t.style.backgroundPosition=c+"% "+d+"%"}}]),_createClass(e,[{key:"componentDidMount",value:function a(){var t=this;this._lnkNodes=this._tr.getElementsByClassName(l);var e=[this._imgLdedP];forEachNodeItem(this._lnkNodes,function(n){n.ftdCttRszHdlr=function(){t._updateBg(n)},e.push(y.add(n,n.ftdCttRszHdlr)),g.register(n)}),this._ldedP=Promise.all(e),this.props.lnksOnLoad(this._lnkNodes)}},{key:"componentWillUnmount",value:function m(){forEachNodeItem(this._lnkNodes,function(t){y.rmv(t,t.ftdCttRszHdlr),g.deregister(t)})}},{key:"getElm",value:function f(){return this._elm}},{key:"lded",value:function p(){return this._ldedP}},{key:"render",value:function v(){return React.createElement("div",{className:"ftd-ctt-cnr","data-idx":this.props.idx,ref:this._setElm},React.createElement("div",{className:"dsp-tr",ref:this._setTr},this._cols))}}]),e}(React.Component),R=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._setElm=n._setElm.bind(n),n}return _inherits(e,t),_createClass(e,[{key:"_setElm",value:function n(t){this._elm=t}}],[{key:"defaultProps",get:function s(){return{clss:""}}}]),_createClass(e,[{key:"getElm",value:function r(){return this._elm}},{key:"render",value:function i(){return React.createElement("button",{className:"no-style clickable "+this.props.clss,style:{backgroundImage:"url("+this.props.imgUrl+")"},"data-idx":this.props.idx,"data-ftd-ctt-idx":this.props.ftdCttIdx,onClick:this.props.onClk,onMouseEnter:this.props.onMseEtr,onMouseLeave:this.props.onMseLve})}}]),e}(React.Component),S=function(t){function s(t){_classCallCheck(this,s);var e=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t));return e.state={slideElms:[],sliderItems:[],crtSlide:0},e._crtBtnIdx=0,e._slideShowIdxIncrement=1,e._setElm=e._setElm.bind(e),e._setSlideCnr=e._setSlideCnr.bind(e),e._setSlideScrlCnr=e._setSlideScrlCnr.bind(e),e._setSlider=e._setSlider.bind(e),e._installContour=e._installContour.bind(e),e._sliderScrl=e._sliderScrl.bind(e),e._sliderItemClk=e._sliderItemClk.bind(e),e.play=e.play.bind(e),e.stop=e.stop.bind(e),e._ldedP=shpsCmm.createAjax("POST",e.props.url,shpsCmm.getRefererParam()+"&refpg="+window.location.hash,"json").then(function(t){var n=t.response;if("Array"===classOf(n)){n.forEach(function(t){imgPreload(t.img_url)}),e._contourP=s._getContour(),s._getCharts().then(function(t){e._cdIndi=t.obj.chartsFactory.createObj("PieSlice",{amtPct:1,ctrHoleRadius:.8,onLdIntro:!1}),e._slideCnr.appendChild(e._cdIndi.getElm())}),e._ftdCtt=n;for(var r=0,i=[],l=[],a=n.length<5?5:n.length,o=0;a>o;o++)r++,r>e._ftdCtt.length-1&&(r=0),3>o&&i.push(React.createElement(I,{key:o.toString(),idx:o,item:e._ftdCtt[r],lnksOnLoad:e._installContour})),l.push(React.createElement(R,{key:o.toString(),idx:o,ftdCttIdx:r,imgUrl:e._ftdCtt[r].img_url,onClk:e._sliderItemClk,onMseEtr:e.stop,onMseLve:e.play}));return e.setState({slideElms:i,sliderItems:l}),void 0}throw new Error("ftd ctt ld failed")}),e}return _inherits(s,t),_createClass(s,[{key:"_setElm",value:function r(t){this._elm=t}},{key:"_setSlideCnr",value:function i(t){this._slideCnr=t}},{key:"_setSlideScrlCnr",value:function l(t){this._slideScrlCnr=t}},{key:"_setSlider",value:function a(t){this._slider=t}},{key:"_installContour",value:function o(t){this._contourP.then(function(e){var n=e.obj.contourFactory;forEachNodeItem(t,function(t){var e=n.createObj(void 0,"opa-0 fade-in-norm").getElm();t.appendChild(e),requestAnimationFrame(function(){e.classList.remove("opa-0")})})})}},{key:"_setSlidesScrlTop",value:function c(){var t=this._slideScrlCnr;t.scrollTop=this._slideScrlTop_pctg*t.clientHeight}},{key:"_sliderScrl",value:function d(){var t=this;if(!this._udRunning){var e=this._slider,n=e.scrollTop,s=e.clientHeight,r=m*s,i=m*s,l=(1-m)*s,a=e.getElementsByTagName("button"),o=[];forEachNodeItem(a,function(t,e){var a=getComputedStyle(t),c=parseInt(a.getPropertyValue("margin-top")),d=t.offsetTop-c-n;if(1>d||d>=l)t.style.removeProperty("height");else{var u=0;u=i>=d?d/i:1-(d-i)/(l-i),t.style.height=r+u*(l-i-r)-c-parseInt(a.getPropertyValue("margin-bottom"))+"px"}var _=r/2;d>-_&&s-_>=d&&o.push(t)}),e.scrollTop=n;var c=[],d=!0;o.forEach(function(e,s){var l=t.state.slideElms,a=l[s],o=e.dataset.idx;if(0===s){var u=e.offsetTop-parseInt(getComputedStyle(e).getPropertyValue("margin-top"))-n;t._slideScrlTop_pctg=(i-u)/r}s>=2&&!a||a.props.idx!=o?(d=!1,l.some(function(t){return t.props.idx==o?(c.push(t),!0):void 0})||c.push(React.createElement(I,{key:o.toString(),idx:o,item:t._ftdCtt[e.dataset.ftdCttIdx],lnksOnLoad:t._installContour}))):c.push(a)}),d?this._setSlidesScrlTop():(this._udRunning=!0,this.setState({slideElms:c}))}}},{key:"_sliderItemClk",value:function u(t){var e=this._slider;this._crtBtnIdx=parseInt(t.currentTarget.dataset.idx);var n=m*e.clientHeight*this._crtBtnIdx;e.scrollTop!=n&&shpsCmm.transScrl(e,n,!1,f,this._sliderScrl)}},{key:"_getNextBtn",value:function _(){return this._slider.getElementsByTagName("button")[this._crtBtnIdx+this._slideShowIdxIncrement]}},{key:"_playCd",value:function h(){var t=this;this._cdIndi&&(this._cdIndi.setTrans(".5s"),this._cdIndi.intro().then(function(){t._cdIndi.setTrans(p-.5+"s ease-in-out"),t._cdIndi.outro()}))}}],[{key:"_getContour",value:function g(){return this._contourP?this._contourP:this._contourP=v.get(e)}},{key:"_getCharts",value:function C(){return this._chartsP?this._chartsP:this._chartsP=v.get(n)}},{key:"defaultProps",get:function y(){return{ttl:"Featured",cap:!0,clss:""}}}]),_createClass(s,[{key:"componentDidMount",value:function b(){}},{key:"componentDidUpdate",value:function S(t,e){this._udRunning&&(this._udRunning=!1,this._setSlidesScrlTop())}},{key:"getElm",value:function x(){return this._elm}},{key:"lded",value:function N(){return this._ldedP}},{key:"intro",value:function P(t,e){var n=this._elm,s=this;return new Promise(function(r,i){requestAnimationFrame(function(){n.classList.remove("dsp-non"),n.addEventListener("transitionend",function i(t){return t.target!==this?!1:(this.removeEventListener("transitionend",i),s._ldedP.then(function(){var t=s._slideCnr;requestAnimationFrame(function(){t.classList.remove("dsp-non"),t.addEventListener("transitionend",function e(t){return t.target!==this?!1:(this.removeEventListener("transitionend",e),r(),void 0)}),optScrlLsnr.add(s._slider,s._sliderScrl),E.add(s._slider,function(){return{v:s._slider.children.length-2}},function(t){var e=s._slider.getElementsByTagName("button")[t.v];return e},function(t){k.triggerOn(t,"click")}),requestAnimationFrame(function(){t.classList.remove("opa-0"),s._introed=!0,s.play()})})}),void 0)}),requestAnimationFrame(function(){t&&n.classList.add(t),e&&(n.style.height=e),n.classList.remove("ftd-cnr-init")})})})}},{key:"play",value:function M(){var t=this;return this._slideShowItvId?!0:this._introed?(this._sliderScrl(),this._playCd(),this._slideShowItvId=setInterval(function(){var e=t._getNextBtn();return e||(t._slideShowIdxIncrement*=-1,e=t._getNextBtn()),e?(k.triggerOn(e,"click"),t._playCd(),void 0):!1},1e3*p),void 0):!1}},{key:"stop",value:function w(){this._slideShowItvId&&(clearInterval(this._slideShowItvId),this._slideShowItvId=void 0,this._cdIndi&&this._cdIndi.close())}},{key:"render",value:function W(){return React.createElement("div",{id:this.props.id,className:"ftd-cnr ftd-cnr-init dsp-non "+this.props.clss,ref:this._setElm},React.createElement("div",{className:"ftd-slide-cnr fade-in-norm opa-0 dsp-non",ref:this._setSlideCnr},React.createElement("div",{className:"scrl-cnr",ref:this._setSlideScrlCnr,onMouseEnter:this.stop,onMouseLeave:this.play},this.state.slideElms),React.createElement("div",{className:"highlight"}),React.createElement("div",{className:"ftd-ttl-bg-bd"},React.createElement("div",{className:"ftd-ttl-bg-ass"}),React.createElement("h3",{className:"ftd-ttl"},this.props.ttl)),React.createElement("div",{className:"ftd-caption-bg-bd"},React.createElement("div",{className:"ftd-caption-bg-hd"}),"These mordern art blocks are dynamically generated. It is different every time you instantiate the page. Refresh the page to see what I mean."),React.createElement("div",{className:"slider clr-aft lv2-cmm-neg-top-btm",ref:this._setSlider},React.createElement("div",null),this.state.sliderItems,React.createElement("div",null))),React.createElement("div",{className:"ftd-bg-side-ptn-top"}),React.createElement("div",{className:"ftd-bg-side-ptn-btm"}))}}]),s}(React.Component),x=a.lv2FtdFactory={};x.createObj=function(t,e,n){function s(t){r=t}var r=void 0;return ReactDOM.render(React.createElement(S,{url:t,clss:e,ref:s}),document.createElement("div")),r}}}();