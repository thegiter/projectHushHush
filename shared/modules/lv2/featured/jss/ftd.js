"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}();!function(){var t="lv2_featured",e="/shared/modules/contour/",n="/shared/modules/charts/",s="/shared/modules/scrl_ind/",r="ftd-ctt-col",i="ftd-ctt-block",l="ftd-ctt-img-cnr",o="ftd-ctt-img",a="lv2-cmm-neg-top-btm",c=3,d=1,u=6,_=2,h=100/c,m=["lft","ctr","rgt"],p=["even","random"],f=.2,v=.5,g=10,C=shpsCmm.moduleMgr,y=shpsAjax.lnkMgr,b=shpsCmm.dataMgr.arr,k=shpsCmm.optElmRszLsnr,E=shpsCmm.evtMgr,I=shpsCmm.swipeClick,S=shpsCmm.animFramePromise,R=shpsCmm.scrlSnap;C.hooks[t]=function(t){var c=t.obj={},b=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._setElm=n._setElm.bind(n),n}return _inherits(e,t),_createClass(e,[{key:"getElm",value:function n(){return this._elm}},{key:"_setElm",value:function s(t){this._elm=t}},{key:"render",value:function r(){return React.createElement("div",{className:i,style:this.props.style},React.createElement("div",{className:l},React.createElement("a",{href:this.props.href,title:this.props.ttl,className:o,style:this.props.imgStyle})))}}]),e}(React.Component),x=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._setElm=n._setElm.bind(n),n}return _inherits(e,t),_createClass(e,[{key:"getElm",value:function n(){return this._elm}},{key:"_setElm",value:function s(t){this._elm=t}},{key:"render",value:function i(){return React.createElement("div",{className:r,style:this.props.style},this.props.children)}}]),e}(React.Component),N=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));n._setElm=n._setElm.bind(n),n._setTr=n._setTr.bind(n);var s=n.props.item,r=s.img_url;n._imgLdedP=shpsCmm.imgLdr.imgLded(r);var i=s.item_link,l=s.txt,o=s.txt_html,a=s.txt_wdt,c=s.txt_pstn;n._avlWdt=100,n._rqdCols=_,n._numColsMax=u,n._calcColWdts();var f=void 0,v=void 0;l?(f="txt",c&&m.includes(c)||(c=m[getRandomInt(0,m.length)]),"ctr"===c&&(n._rqdCols%2===0&&(n._rqdCols++,n._numColsMax<n._rqdCols&&(n._numColsMax=n._rqdCols),n._calcColWdts()),v=(n._rqdCols-1)/2),a?a>n._colWdtMax&&(a=n._colWdtMax):a=getRandomInt(n._colWdtMin,n._colWdtMax+1)):f=p[getRandomInt(0,p.length)];var g=0;for(n._cols=[];n._avlWdt;){var C="img";switch(f){case"txt":switch(c){case"lft":0===g&&(C="txt");break;case"ctr":g===v&&(C="txt");break;case"rgt":n._avlWdt<n._colWdtMin&&(C="txt",a=n._avlWdt)}break;case"even":C="img";break;case"random":C="img";break;default:C="img"}var y=void 0,k=[];switch(0===g&&a&&(n._avlWdt-=a,n._rqdCols--),C){case"img":var E=function(){var t=function _(){a=s-h*(o-1)};n._calcColWdts(),y=getRandomInt(n._colWdtMin,n._colWdtMax+1),n._avlWdt-y<n._colWdtMin&&(y=n._avlWdt);for(var e=0,s=100,l=0,o=d,a=void 0;s>=h;){if(0===e){var c=100-h*d;y>=2*n._colWdtMin&&(c=10),l=getRandomInt(0,c+1),s-=l}t();var u=getRandomInt(h,a);k.push(React.createElement(b,{key:e,style:{top:l+"%",height:u+"%"},href:i,ttl:"Open the featured article.",imgStyle:{backgroundImage:"url("+r+")"}})),o>1&&o--,l+=u,s-=u,e++}return n._rqdCols>1&&n._rqdCols--,n._avlWdt-=y,"break"}();if("break"===E)break;case"txt":y=a}n._cols.push(React.createElement(x,{key:g,style:{width:y+"%"}},k)),g++}return n}return _inherits(e,t),_createClass(e,[{key:"_setElm",value:function n(t){this._elm=t}},{key:"_setTr",value:function s(t){this._tr=t}},{key:"_calcColWdts",value:function r(){this._colWdtMin=100/this._numColsMax,this._colWdtMax=this._avlWdt-this._colWdtMin*(this._rqdCols-1)}},{key:"_updateBg",value:function i(t){var e=this._elm,n=e.offsetWidth,s=e.offsetHeight,r=n,i=r/this._imgAr;s>i&&(i=s,r=i*this._imgAr);var l=t.parentNode.parentNode,o=t.offsetWidth,a=t.offsetHeight,c=0,d=0;o!==r&&(c=(n/2-l.parentNode.offsetLeft-r/2)/(o-r)*100),a!==i&&(d=(s/2-l.offsetTop-i/2)/(a-i)*100);var u=r/o*100,_=i/a*100;t.style.backgroundSize=u+"% "+_+"%",t.style.backgroundPosition=c+"% "+d+"%"}}]),_createClass(e,[{key:"componentDidMount",value:function l(){var t=this;this._lnkNodes=this._tr.getElementsByClassName(o),this._ldedP=this._imgLdedP.then(function(e){t._imgWdt=e.width,t._imgHgt=e.height,t._imgAr=t._imgWdt/t._imgHgt;var n=[];return forEachNodeItem(t._lnkNodes,function(e){e.ftdCttRszHdlr=function(){t._updateBg(e)},n.push(k.add(e,e.ftdCttRszHdlr)),y.register(e)}),Promise.all(n)}).then(function(){t._elm.classList.remove("opa-0")}),this.props.lnksOnLoad(this._lnkNodes)}},{key:"componentWillUnmount",value:function a(){forEachNodeItem(this._lnkNodes,function(t){k.rmv(t,t.ftdCttRszHdlr),y.deregister(t)})}},{key:"getElm",value:function c(){return this._elm}},{key:"lded",value:function f(){return this._ldedP}},{key:"render",value:function v(){return React.createElement("div",{className:"ftd-ctt-cnr dsp-tbl ctr-mrg h-100 pos-rel fade-in-intro-fast opa-0","data-idx":this.props.idx,ref:this._setElm},React.createElement("div",{className:"dsp-tr",ref:this._setTr},this._cols))}}]),e}(React.Component),M=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n._setElm=n._setElm.bind(n),n}return _inherits(e,t),_createClass(e,[{key:"_setElm",value:function n(t){this._elm=t}}],[{key:"defaultProps",get:function s(){return{clss:""}}}]),_createClass(e,[{key:"componentDidMount",value:function r(){this.setState({visible:!0})}},{key:"getElm",value:function i(){return this._elm}},{key:"render",value:function l(){var t="opa-0";return this.state.visible&&(t=""),React.createElement("button",{className:"no-style clickable fade-in-intro-fast "+t+" "+this.props.clss,style:{backgroundImage:"url("+this.props.imgUrl+")"},"data-idx":this.props.idx,"data-ftd-ctt-idx":this.props.ftdCttIdx,onClick:this.props.onClk,onMouseEnter:this.props.onMseEtr,onMouseLeave:this.props.onMseLve})}}]),e}(React.Component),P=function(t){function r(t){_classCallCheck(this,r);var e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t));return e.state={slideElms:[],sliderItems:[],crtSlide:0},e._slideShowIdxIncrement=1,e._setElm=e._setElm.bind(e),e._setSlideCnr=e._setSlideCnr.bind(e),e._setSlideScrlCnr=e._setSlideScrlCnr.bind(e),e._setSliderCnr=e._setSliderCnr.bind(e),e._setSlider=e._setSlider.bind(e),e._installContour=e._installContour.bind(e),e._sliderScrl=e._sliderScrl.bind(e),e._sliderItemClk=e._sliderItemClk.bind(e),e._stopperMseLve=e._stopperMseLve.bind(e),e._stopperMseEtr=e._stopperMseEtr.bind(e),e.play=e.play.bind(e),e.stop=e.stop.bind(e),e._ldedP=shpsCmm.jsonLdr.lded(e.props.url,"refpg="+window.location.hash,e.props.cached,"ftdCtt").then(function(t){if("Array"===classOf(t)){e._ftdCtt=t;var n=0,s=[],i=t.length<5?5:t.length,l=function c(t){return shpsCmm.imgLdr.imgLded(t).then(function(){return t})};e.props.cached&&(l=function d(t){return shpsCmm.iCMgr.getBlobUrl(t,"img")});var o={},a=new Promise(function(s,r){for(var a=function d(r){n++,n>t.length-1&&(n=0);var i=void 0,a=t[n].img_url;o[a]?i=o[a]:o[a]=i=l(a),i.then(function(t){e._ftdCtt[n].img_url=t,e.setState(function(s){var i=s.sliderItems;return i[r]=React.createElement(M,{key:r.toString(),idx:r,ftdCttIdx:n,imgUrl:t,onClk:e._sliderItemClk}),{sliderItems:i}}),s()})},c=0;i>c;c++)a(c)});return e._contourP=r._getContour(),r._getCharts().then(function(t){e._cdIndi=t.obj.chartsFactory.createObj("PieSlice",{amtPct:1,ctrHoleRadius:.8,onLdIntro:!1}),e._sliderCnr.appendChild(e._cdIndi.getElm())}),r._getScrlInd().then(function(t){e._scrlInd=t.obj.scrlIndFactory.createObj({ver:!0}),e._sliderCnr.appendChild(e._scrlInd.getElm()),e._scrlInd.enableVer(e._slider)}),a}throw new Error("ftd ctt ld failed")}),e}return _inherits(r,t),_createClass(r,[{key:"_setElm",value:function i(t){this._elm=t}},{key:"_setSlideCnr",value:function l(t){this._slideCnr=t}},{key:"_setSlideScrlCnr",value:function o(t){this._slideScrlCnr=t}},{key:"_setSliderCnr",value:function c(t){this._sliderCnr=t}},{key:"_setSlider",value:function d(t){this._slider=t}},{key:"_installContour",value:function u(t){this._contourP.then(function(e){var n=e.obj.contourFactory;forEachNodeItem(t,function(t){var e=n.createObj(void 0,"opa-0 fade-in-norm").getElm();new shpsCmm.animFramePromise(function(){t.appendChild(e)}).then(function(){e.classList.remove("opa-0")})})})}},{key:"_setSlidesScrlTop",value:function _(){var t=this._slideScrlCnr;t.scrollTop=this._slideScrlTop_pctg*t.clientHeight}},{key:"_sliderScrl",value:function h(){var t=this;if(!this._udRunning){var e=this._slider,n=e.scrollTop,s=e.clientHeight;if(Math.abs(n-this._sliderLastTop)<1&&Math.abs(s-this._sliderLastHgt)<1)return!0;this._sliderLastTop=n,this._sliderLastHgt=s;var r=f*s,i=f*s,l=(1-f)*s,o=e.getElementsByTagName("button"),a=[];forEachNodeItem(o,function(t,e){var o=getComputedStyle(t),c=parseInt(o.getPropertyValue("margin-top")),d=t.offsetTop-c-n;if(1>d||d>=l)t.style.removeProperty("height");else{var u=0;u=i>=d?d/i:1-(d-i)/(l-i),t.style.height=r+u*(l-i-r)-c-parseInt(o.getPropertyValue("margin-bottom"))+"px"}var _=r/2;d>-_&&s-_>=d&&a.push(t)}),e.scrollTop=n;var c=[],d=!0;a.forEach(function(e,s){var l=t.state.slideElms,o=l[s],a=e.dataset.idx;if(0===s){var u=e.offsetTop-parseInt(getComputedStyle(e).getPropertyValue("margin-top"))-n;t._slideScrlTop_pctg=(i-u)/r}o&&o.props.idx==a?c.push(o):(d=!1,l.some(function(t){return t.props.idx==a?(c.push(t),!0):void 0})||c.push(React.createElement(N,{key:a.toString(),idx:a,item:t._ftdCtt[e.dataset.ftdCttIdx],lnksOnLoad:t._installContour})))}),d?this._setSlidesScrlTop():(this._udRunning=!0,this.setState({slideElms:c}))}}},{key:"_sliderItemClk",value:function m(t){var e=this,n=this._slider;this._crtBtn=t.currentTarget;var s=f*n.clientHeight*Array.prototype.indexOf.call(this._slider.getElementsByTagName("button"),t.currentTarget);n.scrollTop!=s?shpsCmm.transScrl(n,s,!1,v,function(){e._sliderScrl(),e._scrlInd&&e._scrlInd.initVer()}):this._sliderScrl()}},{key:"_getNextBtn",value:function p(){return this._slideShowIdxIncrement>0?this._crtBtn.nextSibling:this._crtBtn.previousSibling}},{key:"_playCd",value:function y(){var t=this;this._cdIndi&&(this._cdIndi.setTrans(".5s"),this._cdIndi.intro().then(function(){t._cdIndi.setTrans(g-.5+"s ease-in-out"),t._cdIndi.outro()}))}},{key:"_stopperMseLve",value:function b(t){this._inStopper=!1,this.play()}},{key:"_stopperMseEtr",value:function x(t){this._inStopper=!0,this.stop()}}],[{key:"_getContour",value:function P(){return this._contourP?this._contourP:this._contourP=C.get(e)}},{key:"_getCharts",value:function L(){return this._chartsP?this._chartsP:this._chartsP=C.get(n)}},{key:"_getScrlInd",value:function w(){return this._scrlIndP?this._scrlIndP:this._scrlIndP=C.get(s)}},{key:"defaultProps",get:function O(){return{ttl:"Featured",cap:!0,clss:""}}}]),_createClass(r,[{key:"componentDidMount",value:function W(){}},{key:"componentDidUpdate",value:function T(t,e){this._udRunning&&(this._udRunning=!1,this._setSlidesScrlTop())}},{key:"getElm",value:function j(){return this._elm}},{key:"lded",value:function B(){return this._ldedP}},{key:"intro",value:function H(t,e){var n=this._elm,s=this;return new Promise(function(r,i){new S(function(){n.classList.remove("dsp-non"),n.addEventListener("transitionend",function t(e){return e.target!==this?!1:(this.removeEventListener("transitionend",t),s._ldedP.then(function(){var t=s._slideCnr;new S(function(){t.classList.remove("dsp-non"),s._sliderCnr.classList.remove("dsp-non"),t.addEventListener("transitionend",function e(t){return t.target!==this?!1:(this.removeEventListener("transitionend",e),r(),void 0)}),optScrlLsnr.add(s._slider,s._sliderScrl),I.add(s._slider,function(){return{v:s._slider.getElementsByTagName("button").length}},function(t){var e=s._slider.getElementsByTagName("button")[t.v];return e},function(t){E.triggerOn(t,"click")}),k.add(s._slider,function(){R.scrlEndHdlr(void 0,s._slider)})}).then(function(){t.classList.remove("opa-0"),s._introed=!0,s.play()})}),void 0)})}).then(function(){t&&n.classList.add(t),e&&(n.style.height=e),n.classList.remove("ftd-cnr-init")})})}},{key:"play",value:function q(){var t=this;return this._slideShowItvId?!0:!this._introed||this._inStopper?!1:(this._playCd(),this._slideShowItvId=setInterval(function(){var e=t._getNextBtn();return e&&"button"==e.tagName||(t._slideShowIdxIncrement*=-1,e=t._getNextBtn()),e&&"button"==e.tagName?(E.triggerOn(e,"click"),t._playCd(),void 0):!1},1e3*g),void 0)}},{key:"stop",value:function F(){this._slideShowItvId&&(clearInterval(this._slideShowItvId),this._slideShowItvId=void 0,this._cdIndi&&this._cdIndi.close())}},{key:"render",value:function A(){return React.createElement("div",{id:this.props.id,className:"ftd-cnr ftd-cnr-init dsp-non "+this.props.clss,ref:this._setElm},React.createElement("div",{className:"ftd-slide-cnr fade-in-norm opa-0 dsp-non",ref:this._setSlideCnr,onMouseEnter:this._stopperMseEtr,onMouseLeave:this._stopperMseLve},React.createElement("div",{className:"highlight pos-abs-ful"}),React.createElement("div",{className:"scrl-cnr",ref:this._setSlideScrlCnr},this.state.slideElms),React.createElement("div",{className:"ftd-ttl-bg-bd"},React.createElement("div",{className:"ftd-ttl-bg-ass"}),React.createElement("h3",{className:"ftd-ttl"},this.props.ttl)),React.createElement("div",{className:"ftd-caption-bg-bd"},React.createElement("div",{className:"ftd-caption-bg-hd"}),"These mordern art blocks are dynamically generated. It is different every time you instantiate the page. Refresh the page to see what I mean.")),React.createElement("div",{className:"side-sdw-cnr pos-abs-ful disabled of-hid"},React.createElement("div",{className:"ftd-bg-side-ptn-top"}),React.createElement("div",{className:"ftd-bg-side-ptn-btm"})),React.createElement("div",{className:"slider-cnr of-hid pos-abs rgt-0 disabled dsp-non "+a,ref:this._setSliderCnr},React.createElement("div",{className:"slider clr-aft pos-abs top-0 btm-0 lft-0",ref:this._setSlider},React.createElement("div",null),this.state.sliderItems,React.createElement("div",null))))}}]),r}(React.Component),L=c.lv2FtdFactory={};L.createObj=function(t){function e(t){n=t}var n=void 0;return ReactDOM.render(React.createElement(P,_extends({},t,{ref:e})),document.createElement("div")),n}}}();