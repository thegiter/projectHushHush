"use strict";!function(){var t="lv2_featured",e="/shared/modules/contour/",i="ftd-ctt-cnr",n="ftd-ctt-col",r="ftd-ctt-block",s="ftd-ctt-img-cnr",o="ftd-ctt-img",a=shpsCmm.moduleMgr;a.hooks[t]=function(t){var m=t.obj={},d=m.lv2Ftd=function(t,e,n){var r=this;this.cnr=t,this.cttCnr=t.getElementsByClassName(i)[0],this.itemIdx=0,this.ldedP=shpsCmm.createAjax("POST",e,shpsCmm.getRefererParam()+"&refpg="+window.location.hash,"json").then(function(t){var e=t.response;if("Array"==classOf(e))return e.forEach(function(t){imgPreload(t.img_url)}),d.getContour(),r.ftdCtt=e,void 0;throw new Error("ftd ctt ld failed")})};d.prototype.lded=function(){return this.ldedP},d.prototype.intro=function(t,e){var i=this.cnr;return new Promise(function(n,r){requestAnimationFrame(function(){i.classList.remove("dsp-non"),i.addEventListener("transitionend",function r(t){return t.target!=this?!1:(this.removeEventListener("transitionend",r),n(),void 0)}),requestAnimationFrame(function(){t&&i.classList.add(t),e&&(i.style.height=e),i.classList.remove("ftd-cnr-init")})})})},d.prototype.createCtt=function(){function t(t){var e=m,i=h,n=a.offsetWidth,r=a.offsetHeight;e=n,i=e/A,r>i&&(i=r,e=i*A);var s=t.parentNode.parentNode,o=t.offsetWidth,d=t.offsetHeight,c=0,l=0;o!=e&&(c=(n/2-s.parentNode.offsetLeft-e/2)/(o-e)*100),d!=i&&(l=(r/2-s.offsetTop-i/2)/(d-i)*100);var g=e/o*100,f=i/d*100;t.style.backgroundSize=g+"% "+f+"%",t.style.backgroundPosition=c+"% "+l+"%"}var e=this.ftdCtt[this.itemIdx],i=e.img_url;this.imgLdedP=shpsCmm.imgLdr.imgLded(i);var a=this.cttCnr,m=e.img_wdt,h=e.img_hgt,c=e.item_link,l=e.txt,g=e.txt_pstn,f=e.txt_wdt,u=e.txt_html,v=a.children[0];this.ttlWdt=a.offsetWidth,this.ttlHgt=a.offsetHeight,this.block_hgt_min=Math.round(this.ttlHgt/3),this.img_wdt_min=Math.round(this.ttlWdt/6),this.img_wdt_max=this.ttlWdt-this.img_wdt_min;var p=this.ttlWdt,_=p,y;if(l){if(y="txt","undefined"==typeof g||"lft"!=g){var w=["lft","ctr","rgt"];g=w[getRandomInt(0,3)]}if("ctr"==g){var x=this.ttlWdt-2*this.img_wdt_min;("undefined"==typeof f||f>x)&&(f=getRandomInt(img_wdt_min,x+1)),this.img_wdt_max-=f}else("undefined"==typeof f||f>this.img_wdt_max)&&(f=getRandomInt(this.img_wdt_min,this.img_wdt_max+1)),this.img_wdt_max=this.ttlWdt-f;_=this.ttlWdt-f}else{var B=["even","random"];y=B[getRandomInt(0,2)]}for(var C=[],E=0,L=0,P=[];p;){var b="img";switch(y){case"txt":switch(g){case"lft":0===E&&(b="txt");break;case"ctr":1==E&&(b="txt");break;case"rgt":p<f+this.img_wdt_min&&(b="txt")}break;case"even":b="img";break;case"random":b="img"}var k="";switch(b){case"img":C[E]=getRandomInt(this.img_wdt_min,this.img_wdt_max+1),_-C[E]<this.img_wdt_min&&(C[E]=_);for(var H=0,N=[],I=this.ttlHgt;I>=this.block_hgt_min;){var O;if(0===H){var T;T=C[E]>=2*this.img_wdt_min?.1*this.ttlHgt:this.ttlHgt-this.block_hgt_min,O=getRandomInt(0,T+1),I-=O}else O+=N[H-1].hgt;var W=getRandomInt(this.block_hgt_min,this.ttlHgt-O);I-=W;var R=W/this.ttlHgt*100,F=O/this.ttlHgt*100;k+='\r\n							<div class="'+r+'" style="top:'+F+"%;height:"+R+'%;">\r\n								<div class="'+s+'">\r\n									<a href="'+c+'" title="Open the featured article." class="'+o+'" style="background-image:url('+i+');">\r\n									</a>\r\n								</div>\r\n							</div>',N[H]={top:O,hgt:W},H++}_-=C[E];break;case"txt":C[E]=f,k=txtHTML}P.push('<div class="'+n+'" style="width:'+C[E]+'px"><!--col stands for column-->'+k+"\r\n				</div>"),p-=C[E],L+=C[E],E++}v.innerHTML=P.join(""),this.contourP=d.contourP.then(function(t){forEachNodeItem(v.getElementsByClassName(o),function(e){var i=t.cloneNode(!0);e.appendChild(i),requestAnimationFrame(function(){i.classList.remove("opa-0")})})});var A=m/h,M=[];return forEachNodeItem(v.getElementsByClassName(o),function(e){M.push(shpsCmm.optElmRszLsnr.add(e,function(){t(e)}))}),Promise.all(M)},d.prototype.introBlks=function(){var t=this.cttCnr;this.imgLdedP.then(function(){t.classList.remove("vsb-hid");var e=new Promise(function(e,i){t.addEventListener("transitionend",function n(t){return t.target!=this?!1:(this.removeEventListener("transitionend",n),e(),void 0)})});return requestAnimationFrame(function(){t.classList.remove("opa-0")}),e})},d.prototype.maxBlks=function(){var t=this.cttCnr;if(!t.mB){t.mB=!0;var e=this;forEachNodeItem(t.getElementsByClassName(n),function(t,i){forEachNodeItem(t.children,function(i,n){if(i.mBOrigTop||(i.mBOrigTop=parseFloat(i.style.top)),i.mBOrigHgt||(i.mBOrigHgt=parseFloat(i.style.height)),0===n){var r=i.mBOrigTop+i.mBOrigHgt;i.style.top=0,i.style.height=r+"%"}n===t.children.length-1&&(i.style.height=100-parseFloat(i.style.top)+"%");var s=i.children[0];s.style.bottom=0,s.style.right=0;var o=s.children[0];o.style.boxShadow="none",e.contourP.then(function(){o.getElementsByTagName("div")[0].classList.add("opa-0")})})})}},d.prototype.restoreBlks=function(){var t=this,e=this.cttCnr;e.mB&&(e.mB=!1,forEachNodeItem(e.getElementsByClassName(n),function(e,i){forEachNodeItem(e.children,function(e,i){var n=e.children[0],r=n.children[0];t.contourP.then(function(){r.getElementsByTagName("div")[0].classList.remove("opa-0")}),n.style.removeProperty("bottom"),n.style.removeProperty("right"),e.style.height=e.mBOrigHgt+"%",0===i&&(e.style.top=e.mBOrigTop+"%"),r.style.removeProperty("box-shadow")})}))},d.getContour=function(){return this.contourP?this.contourP:this.contourP=a.get(e).then(function(t){var e=document.createElement("div");return e.innerHTML='<div class="contour-wpr opa-0 fade-in-norm">\r\n					'+t.html+"\r\n				</div>",e.children[0]})}}}();