"use strict";function set(e){return chkDbP.then(function(){var t=db.transaction(OBJ_STORE_NAME,"readwrite").objectStore(OBJ_STORE_NAME).put(e);return new Promise(function(n,r){t.addEventListener("success",function(){cache[e.url]=e,n(e)})})})}function rmv(e){return chkDbP.then(function(){var t=db.transaction(OBJ_STORE_NAME,"readwrite").objectStore(OBJ_STORE_NAME)["delete"](e);return new Promise(function(n,r){t.addEventListener("success",function(){delete cache[e],n()}),t.addEventListener("error",r)})})}function get(e){return cache[e]?Promise.resolve(cache[e]):chkDbP.then(function(){var t=db.transaction(OBJ_STORE_NAME).objectStore(OBJ_STORE_NAME).get(e);return new Promise(function(n,r){t.addEventListener("success",function(){t.result?(cache[e]=t.result,n(cache[e])):r()}),t.addEventListener("error",r)})})}var OBJ_STORE_NAME="info",DB_NAME="ifInfo",VER=3,chkRqs=indexedDB.open(DB_NAME,VER),db=void 0,chkDbP=new Promise(function(e,t){chkRqs.addEventListener("error",function(e){t()}),chkRqs.addEventListener("upgradeneeded",function(e){var t=chkRqs.result;t.objectStoreNames.contains(OBJ_STORE_NAME)&&t.deleteObjectStore(OBJ_STORE_NAME),t.createObjectStore(OBJ_STORE_NAME,{keyPath:"url"})}),chkRqs.addEventListener("success",function(t){db=chkRqs.result,e()})}),cache={},MAX_AGE=604800,NAME="installer",FILES=["/?ffd82ea5=oxkecl23","/shared/imgs/favicon.ico","/shared/csss/default.css","/manifest.json","/jss/installer.js"],cacheName=NAME+VER;self.addEventListener("install",function(e){e.waitUntil(caches.open(cacheName).then(function(e){return e.addAll(FILES).then(function(){return Promise.all([set({url:"installer",installDate:(new Date).toUTCString()}),caches.match(new Request("/?ffd82ea5=oxkecl23")).then(function(t){var n=t.clone();return Promise.all([e.put(new Request("/"),n),e.put(new Request("/?utm_source=homescreen"),t)])})])})}))}),self.addEventListener("activate",function(e){console.log("WORKER: activate event in progress."),e.waitUntil(caches.keys().then(function(e){return Promise.all(e.map(function(e){return e!==cacheName?caches["delete"](e):void 0}))}).then(function(){console.log("WORKER: activate completed.")}))}),self.addEventListener("fetch",function(e){e.respondWith(caches.match(e.request).then(function(t){if(t){var n=t,r=e.request.url;return get(r)["catch"](function(){return{url:r}}).then(function(t){var c=t.lastChkDate||0;if(parseInt(c)+MAX_AGE>=Date.now())throw new Error("not expired");new Promise(function(e,n){var r=t.lastModified;r&&"null"!=r?e(r):get("installer").then(function(t){e(t.installDate)})}).then(function(e){var n=new Headers;n.append("If-Modified-Since",e);var c=t.eTag;c&&n.append("If-None-Match",c);var a=r;return"/"==new URL(r).pathname&&(a="/?ffd82ea5=oxkecl23"),fetch(a,{method:"get",headers:n})}).then(function(r){if(t.lastChkDate=Date.now(),200==r.status){n=r,caches.open(cacheName).then(function(t){t.put(e.request,r)}),t.lastModified=r.headers.get("Last-Modified");var c=r.headers.get("Etag");c&&(t.eTag=c)}set(t)})}),n}return fetch(e.request)["catch"](function(e){return new Response("<h1>\n                Service Unavailable\n            </h1>",{status:503,statusText:"Service Unavailable",headers:new Headers({"Content-Type":"text/html"})})})}))});